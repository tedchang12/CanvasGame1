<html><head>
        <meta charset="utf-8">
        <title>HelloCanvas</title>
        <!--
        <meta http-equiv="Refresh" content="3" />
        -->
    </head>


    <body>
        <div >
        <canvas  id="myCanvas2" onmousedown="getPOS()" width="650" height="650" style="border:1px solid gray"> </canvas>
        </div>
        <script>

            function getPOS(curx,cury)
            {
                var counter = 0;
                counter += Math.floor(curx/50);
                counter += Math.floor(cury/50)*13;
                
                return counter;
            }
            var currentX = 50*6;
            var currentY = 50*6;

            //畫線
            var c2=document.getElementById("myCanvas2");
            var cxt2=c2.getContext("2d");
            cxt2.strokeStyle="blue";
            cxt2.lineWidth="1";
            //creat a 13*13 cube
            for(var x=50;x<=650;x+=50)
            {
                cxt2.moveTo(x,0);
                cxt2.lineTo(x,650); 
            }
            for(var x=50;x<=650;x+=50)
            {
                cxt2.moveTo(0,x);
                cxt2.lineTo(650,x); 
            }
            cxt2.stroke();
            var manIMG = new Image();
            manIMG.src="man.png"
            manIMG.onload = function()
            {
                cxt2.drawImage(manIMG,0,0,80,130,currentX,currentY,50,50);
            }

            document.addEventListener('keydown', function(event) {
            //38 UP
            //40 DOWN
            //37 LEFT
            //39 RIGHT
            var man_pos = getPOS(currentX,currentY);
            if(event.keyCode==38)//up
            {
                man_pos-=13;
            }
            if(event.keyCode==40)//down
            {
                man_pos+=13;
            }

            if(event.keyCode==37)//left
            {
                man_pos-=1;
            }

            if(event.keyCode==39)//right
            {
                man_pos+=1;
            }
            cxt2.clearRect(currentX+0.6,currentY+0.9,47,48);
            currentY = Math.floor(man_pos/13)*50;
            currentX = Math.floor(man_pos%13)*50;
            cxt2.drawImage(manIMG,0,0,80,130,currentX,currentY,50,50);
            });
            
            
        </script>   
    

</body></html>
